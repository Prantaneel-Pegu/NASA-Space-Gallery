import{r as u,f as U,g as v,a as L,c as K,j as e,L as O,S as R,i as M,I as D,M as T,b as I,d as j,u as G,e as H}from"./main-CW9VwAtJ.js";var V=Object.defineProperty,z=(s,r,t)=>r in s?V(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,N=(s,r,t)=>(z(s,typeof r!="symbol"?r+"":r,t),t);const b=(s,r)=>typeof getComputedStyle<"u"?getComputedStyle(s,null).getPropertyValue(r):s.style.getPropertyValue(r),A=s=>b(s,"overflow")+b(s,"overflow-y")+b(s,"overflow-x"),B=s=>{if(!(s instanceof HTMLElement))return window;let r=s;for(;r&&!(r===document.body||r===document.documentElement||!r.parentNode);){if(/(scroll|auto)/.test(A(r)))return r;r=r.parentNode}return window};class C extends u.Component{constructor(r){super(r),N(this,"elementObserver"),N(this,"wrapper"),N(this,"lazyLoadHandler",t=>{var a,o;const{onContentVisible:c}=this.props,[g]=t,{isIntersecting:m}=g;if(m){this.setState({visible:!0},()=>{c&&c()});const n=(a=this.wrapper)==null?void 0:a.current;n&&n instanceof HTMLElement&&((o=this.elementObserver)==null||o.unobserve(n))}}),this.elementObserver=null,this.wrapper=U.createRef(),this.state={visible:!1}}componentDidMount(){var r;this.getEventNode();const{offset:t,threshold:a}=this.props,o={rootMargin:typeof t=="number"?`${t}px`:t||"0px",threshold:a||0};this.elementObserver=new IntersectionObserver(this.lazyLoadHandler,o);const c=(r=this.wrapper)==null?void 0:r.current;c instanceof HTMLElement&&this.elementObserver.observe(c)}shouldComponentUpdate(r,t){return t.visible}componentWillUnmount(){var r,t;const a=(r=this.wrapper)==null?void 0:r.current;a&&a instanceof HTMLElement&&((t=this.elementObserver)==null||t.unobserve(a))}getEventNode(){var r;return B((r=this.wrapper)==null?void 0:r.current)}render(){const{children:r,className:t,height:a,width:o,elementType:c}=this.props,{visible:g}=this.state,m={height:a,width:o},n=`LazyLoad${g?" is-visible":""}${t?` ${t}`:""}`;return u.createElement(c||"div",{className:n,style:m,ref:this.wrapper},g&&u.Children.only(r))}}N(C,"defaultProps",{elementType:"div",className:"",offset:0,threshold:0,width:null,onContentVisible:null,height:null});function J({keywords:s,exclude:r}){const[t,a]=u.useState(v),[o,c]=u.useState([]),[g,m]=u.useState(!1),n=u.useRef(0),k=(s==null?void 0:s.join())||"",F=JSON.stringify(r),S=u.useCallback(()=>{console.log("IN CALLBACK",t);const y=JSON.parse(F);L(k,n.current).then(l=>{a(l);const i=K(l);console.log("GOT RESPONSE: ",i);const d=[];if(i.error!==""){const h=e.jsx("div",{id:"km-error-element",children:e.jsx("p",{id:"km-error-info",children:i.error.split(`
`).map((p,f)=>e.jsxs("span",{children:[p,e.jsx("br",{})]},f))})},"KM-ERROR-ELEMENT");d.push(h),c([...d]),m(!0),console.error("ENCOUNTERED ERROR IN USEEFFECT",...d);return}for(let h=0;h<Math.min(i.numberOfResults-1,20);h++){const p=i.imageLink[h],f=i.id[h],E=i.title[h],x=i.description[h],w=70,$=x.length>w?x.substring(0,w-3)+"...":x;y.includes(f)||d.push(e.jsx(O,{to:`/gallery/${f}`,className:"keyword-matches-link",children:e.jsxs("article",{className:"keyword-matches-tile",children:[e.jsx(R,{src:p,alt:E,classes:"keyword-matches-image"}),e.jsx("p",{className:"keyword-matches-description",children:$})]})},f))}M(o,d)||(console.log(o,i),c(d)),n.current===0&&(n.current+=20),m(!0)}).catch(l=>{l instanceof TypeError?(t.error!=="No keyword matches found."&&(a({...v,error:"No keyword matches found."}),console.log("Encountered TypeError.")),console.log("Encountered TypeError")):l instanceof Error&&l.name==="Error"?(t.error!=="Sorry, an unexpected error occurred."&&a({...v,error:"Sorry, an unexpected error occurred."}),console.log(`Encountered an Error. 
Error message: ${l.message||"none"}`)):(t.error===""&&a({...v,error:`Unexpected error occured of type '${l.name}'.`}),console.log(`Encountered ${l.name}.`))})},[]);u.useEffect(()=>{console.log("IN USEEFFECT"),S(),console.log("EXITING USEEFFECT")},[S]);function P(y=20){console.log("IN LOAD MORE",t),L(k,n.current+y).then(l=>{a(l);const i=[];if(l.error!==""){const d=e.jsx("div",{id:"km-error-element",children:e.jsx("p",{id:"km-error-info",children:l.error.split(`
`).map((h,p)=>e.jsxs("span",{children:[h,e.jsx("br",{})]},p))})},"KM-ERROR-ELEMENT");i.push(...o),i.pop(),i.push(d),c([...i]),console.log(i),console.error("ENCOUNTERED ERROR IN USEEFFECT",i);return}console.log(l.numberOfResults,y+n.current);for(let d=0;d<Math.min(l.numberOfResults,y+n.current);d++){const h=l.imageLink[d],p=l.id[d],f=l.title[d],E=l.description[d],x=70,w=(E==null?void 0:E.length)>x?E.substring(0,x-3)+"...":E;[...r].includes(p)||i.push(e.jsx(O,{to:`/gallery/${p}`,className:"keyword-matches-link",children:e.jsxs("article",{className:"keyword-matches-tile",children:[e.jsx(R,{src:h,alt:f,classes:"keyword-matches-image"}),e.jsx("p",{className:"keyword-matches-description",children:w})]})},p))}n.current+=y,console.log(o,i,n.current),M(o,i)||(c(i),console.log(o,i))})}return g?e.jsx(e.Fragment,{children:e.jsxs("div",{id:"KeywordMatches",children:[!t.error&&t.numberOfResults-r.length>o.length?e.jsx("h3",{id:"keyword-matches-heading",children:"See more pictures like this:"}):null,e.jsx("div",{className:"keyword-matches-grid",children:e.jsx(D,{next:P,hasMore:t.numberOfResults-r.length>o.length&&t.error==="",children:t.error?o.length===1?o:e.jsx(T,{columnsCountBreakPoints:{320:1,550:2,900:3,1200:4},children:e.jsx(I,{gutter:"2em",children:o})}):e.jsx(T,{columnsCountBreakPoints:{320:1,550:2,900:3,1200:4},children:e.jsx(I,{gutter:"2em",children:o})}),loader:e.jsx("div",{className:"loader"}),dataLength:o.length,scrollThreshold:.8,style:{overflow:"visible"}})})]})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})}function W(){const[s,r]=u.useState(j),[t,a]=u.useState(!1),o=u.useRef(0),c=G(),g=u.useRef({id:c.id||""}),m=c.id;return window.scrollTo(0,0),u.useLayoutEffect(()=>{scrollTo(0,o.current)}),u.useEffect(()=>{m?H(m).then(n=>{o.current=Math.round(window.scrollY),g.current.id=m,r({...n}),a(!0)}).catch(n=>{console.log(n),n instanceof TypeError?(s.error!==n.name&&r({...j,error:"No keyword matches found."}),console.log("Encountered TypeError")):n instanceof Error&&n.name==="Error"?(s.error!==n.name&&r({...j,error:"Sorry, an unexpected error occurred."}),console.log(`Encountered an Error. 
Error message: ${n.message||"none"}`)):(s.error!==n.name&&r({...j,error:`Unexpected error occured of type '${n.name}'.`}),console.log(`Encountered ${n.name}.`))}):r({...j,error:"Sorry, the requested image was not found."})},[m,s.error]),s.error!==""?e.jsx("div",{id:"GalleryImage",children:e.jsx("h1",{id:"error-info",children:s.error.split(`
`).map(n=>e.jsxs(e.Fragment,{children:[n,e.jsx("br",{})]}))})}):t&&c.id===g.current.id?e.jsxs("div",{id:"GalleryImage",children:[e.jsxs("div",{id:"gi-main",children:[e.jsx("div",{id:"gallery-image-container",children:e.jsx("img",{src:s.imageLink,alt:s.title,id:"gallery-image"})}),e.jsxs("div",{id:"gi-data",children:[e.jsx("h1",{id:"gi-image-title",children:s.title}),e.jsx("br",{}),e.jsx("p",{id:"gi-description",children:s.description}),e.jsx("br",{}),e.jsxs("code",{id:"gallery-image-address",children:[e.jsx("p",{id:"gallery-address-heading",children:"Image address:"}),e.jsx("a",{href:s.imageLink,className:"gallery-img-link",children:s.imageLink})]}),e.jsx("a",{id:"gallery-download-link",href:s.imageLink,download:s.title,children:e.jsx("h2",{children:"Download Image"})})]})]}),e.jsx(C,{children:e.jsx(J,{keywords:s.keywords,exclude:[s.id]})})]}):e.jsx("div",{id:"GalleryImage",children:e.jsx("div",{className:"loader"})})}export{W as default};
