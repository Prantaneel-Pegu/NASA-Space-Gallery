import{r as i,f as U,g as O,a as G,c as H,j as r,L as $,S as P,i as D,I as V,M as q,b as z,d as M,u as J,e as W}from"./main-ByG57hRm.js";var B=Object.defineProperty,X=(t,e,n)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,C=(t,e,n)=>(X(t,typeof e!="symbol"?e+"":e,n),n);const F=(t,e)=>typeof getComputedStyle<"u"?getComputedStyle(t,null).getPropertyValue(e):t.style.getPropertyValue(e),Y=t=>F(t,"overflow")+F(t,"overflow-y")+F(t,"overflow-x"),Q=t=>{if(!(t instanceof HTMLElement))return window;let e=t;for(;e&&!(e===document.body||e===document.documentElement||!e.parentNode);){if(/(scroll|auto)/.test(Y(e)))return e;e=e.parentNode}return window};class K extends i.Component{constructor(e){super(e),C(this,"elementObserver"),C(this,"wrapper"),C(this,"lazyLoadHandler",n=>{var u,o;const{onContentVisible:l}=this.props,[a]=n,{isIntersecting:h}=a;if(h){this.setState({visible:!0},()=>{l&&l()});const s=(u=this.wrapper)==null?void 0:u.current;s&&s instanceof HTMLElement&&((o=this.elementObserver)==null||o.unobserve(s))}}),this.elementObserver=null,this.wrapper=U.createRef(),this.state={visible:!1}}componentDidMount(){var e;this.getEventNode();const{offset:n,threshold:u}=this.props,o={rootMargin:typeof n=="number"?`${n}px`:n||"0px",threshold:u||0};this.elementObserver=new IntersectionObserver(this.lazyLoadHandler,o);const l=(e=this.wrapper)==null?void 0:e.current;l instanceof HTMLElement&&this.elementObserver.observe(l)}shouldComponentUpdate(e,n){return n.visible}componentWillUnmount(){var e,n;const u=(e=this.wrapper)==null?void 0:e.current;u&&u instanceof HTMLElement&&((n=this.elementObserver)==null||n.unobserve(u))}getEventNode(){var e;return Q((e=this.wrapper)==null?void 0:e.current)}render(){const{children:e,className:n,height:u,width:o,elementType:l}=this.props,{visible:a}=this.state,h={height:u,width:o},s=`LazyLoad${a?" is-visible":""}${n?` ${n}`:""}`;return i.createElement(l||"div",{className:s,style:h,ref:this.wrapper},a&&i.Children.only(e))}}C(K,"defaultProps",{elementType:"div",className:"",offset:0,threshold:0,width:null,onContentVisible:null,height:null});function Z(t,e,n){var u=this,o=i.useRef(null),l=i.useRef(0),a=i.useRef(null),h=i.useRef([]),s=i.useRef(),j=i.useRef(),R=i.useRef(t),w=i.useRef(!0);R.current=t;var N=typeof window<"u",k=!e&&e!==0&&N;if(typeof t!="function")throw new TypeError("Expected a function");e=+e||0;var y=!!(n=n||{}).leading,d=!("trailing"in n)||!!n.trailing,c="maxWait"in n,x="debounceOnServer"in n&&!!n.debounceOnServer,m=c?Math.max(+n.maxWait||0,e):null;i.useEffect(function(){return w.current=!0,function(){w.current=!1}},[]);var b=i.useMemo(function(){var g=function(f){var p=h.current,I=s.current;return h.current=s.current=null,l.current=f,j.current=R.current.apply(I,p)},v=function(f,p){k&&cancelAnimationFrame(a.current),a.current=k?requestAnimationFrame(f):setTimeout(f,p)},E=function(f){if(!w.current)return!1;var p=f-o.current;return!o.current||p>=e||p<0||c&&f-l.current>=m},S=function(f){return a.current=null,d&&h.current?g(f):(h.current=s.current=null,j.current)},L=function f(){var p=Date.now();if(E(p))return S(p);if(w.current){var I=e-(p-o.current),A=c?Math.min(I,m-(p-l.current)):I;v(f,A)}},T=function(){if(N||x){var f=Date.now(),p=E(f);if(h.current=[].slice.call(arguments),s.current=u,o.current=f,p){if(!a.current&&w.current)return l.current=o.current,v(L,e),y?g(o.current):j.current;if(c)return v(L,e),g(o.current)}return a.current||v(L,e),j.current}};return T.cancel=function(){a.current&&(k?cancelAnimationFrame(a.current):clearTimeout(a.current)),l.current=0,h.current=o.current=s.current=a.current=null},T.isPending=function(){return!!a.current},T.flush=function(){return a.current?S(Date.now()):j.current},T},[y,c,e,m,d,k,N,x]);return b}function _({keywords:t,exclude:e}){const[n,u]=i.useState(O),[o,l]=i.useState([]),[a,h]=i.useState(!1),s=i.useRef(0),j=t.join(),R=JSON.stringify(e),w=i.useCallback(()=>{console.warn("IN CALLBACK",n);const y=JSON.parse(R);G(j).then(d=>{u(d);const c=H(d);console.log("GOT RESPONSE: ",c);const x=[];if(c.error!==""){const m=r.jsx("div",{id:"KeywordMatches",children:r.jsx("p",{id:"km-error-info",children:c.error.split(`
`).map((b,g)=>r.jsxs("p",{children:[b,r.jsx("br",{})]},g))})});x.push(m),l([...x]),console.error("ENCOUNTERED ERROR IN USEEFFECT",...x);return}for(let m=0;m<Math.min(c.numberOfResults-1,20);m++){const b=c.imageLink[m],g=c.id[m],v=c.title[m],E=c.description[m],S=70,L=E.length>S?E.substring(0,S-3)+"...":E;y.includes(g)||x.push(r.jsx($,{to:`/gallery/${g}`,className:"keyword-matches-link",children:r.jsxs("article",{className:"keyword-matches-tile",children:[r.jsx(P,{src:b,alt:v,classes:"keyword-matches-image"}),r.jsx("p",{className:"keyword-matches-description",children:L})]})},g))}D(o,x)||(console.log(o,c),l(x)),s.current===0&&(s.current+=20),h(!0)}).catch(d=>{d instanceof TypeError?(n.error!=="No keyword matches found."&&(u({...O,error:"No keyword matches found."}),console.log("Encountered TypeError.")),console.log("Encountered TypeError")):d instanceof Error&&d.name==="Error"?(n.error!=="Sorry, an unexpected error occurred."&&u({...O,error:"Sorry, an unexpected error occurred."}),console.log(`Encountered an Error. 
Error message: ${d.message||"none"}`)):(n.error===""&&u({...O,error:`Unexpected error occured of type '${d.name}'.`}),console.log(`Encountered ${d.name}.`))})},[]);i.useEffect(()=>{console.warn("IN USEEFFECT"),w(),console.warn("EXITING USEEFFECT")},[w]);function N(y=20){console.log("IN LOAD MORE",n);const d=[];for(let c=0;c<Math.min(n.imageLink.length,y+s.current);c++){const x=n.imageLink[c],m=n.id[c],b=n.title[c],g=n.description[c],v=70,E=g.length>v?g.substring(0,v-3)+"...":g;[...e].includes(m)||d.push(r.jsx($,{to:`/gallery/${m}`,className:"keyword-matches-link",children:r.jsxs("article",{className:"keyword-matches-tile",children:[r.jsx(P,{src:x,alt:b,classes:"keyword-matches-image"}),r.jsx("p",{className:"keyword-matches-description",children:E})]})},m))}s.current+=y,console.log(o,d,s.current),D(o,d)||(l(d),console.log(o,d))}const k=Z((y=20)=>N(y),3e3);return n.error!==""?r.jsx("div",{id:"KeywordMatches",children:r.jsx("h2",{id:"error-info",children:n.error.split(`
`).map((y,d)=>r.jsxs("p",{children:[y,r.jsx("br",{})]},d))})}):a?r.jsx(r.Fragment,{children:r.jsxs("div",{id:"KeywordMatches",children:[!n.error&&r.jsx("h3",{id:"keyword-matches-heading",children:"See more pictures like this:"}),r.jsx("div",{className:"keyword-matches-grid",children:r.jsx(V,{next:k,hasMore:n.imageLink.length-e.length!==o.length&&n.error==="",children:n.error===""?r.jsx(q,{columnsCountBreakPoints:{320:1,550:2,900:3,1200:4},children:r.jsx(z,{gutter:"2em",children:o})}):o,loader:r.jsx("div",{className:"loader"}),dataLength:o.length,scrollThreshold:.8,style:{overflow:"visible"}})})]})}):r.jsx(r.Fragment,{children:r.jsx("div",{className:"loader"})})}function re(){const[t,e]=i.useState(M),[n,u]=i.useState(!1),o=i.useRef(0),l=J(),a=i.useRef({id:l.id||""}),h=l.id;return window.scrollTo(0,0),i.useLayoutEffect(()=>{scrollTo(0,o.current)}),i.useEffect(()=>{h?W(h).then(s=>{o.current=Math.round(window.scrollY),a.current.id=h,e({...s}),u(!0)}).catch(s=>{console.log(s),s instanceof TypeError?(t.error!==s.name&&e({...M,error:"No keyword matches found."}),console.log("Encountered TypeError")):s instanceof Error&&s.name==="Error"?(t.error!==s.name&&e({...M,error:"Sorry, an unexpected error occurred."}),console.log(`Encountered an Error. 
Error message: ${s.message||"none"}`)):(t.error!==s.name&&e({...M,error:`Unexpected error occured of type '${s.name}'.`}),console.log(`Encountered ${s.name}.`))}):e({...M,error:"Sorry, the requested image was not found."})},[h,t.error]),t.error!==""?r.jsx("div",{id:"GalleryImage",children:r.jsx("h1",{id:"error-info",children:t.error.split(`
`).map(s=>r.jsxs(r.Fragment,{children:[s,r.jsx("br",{})]}))})}):n&&l.id===a.current.id?r.jsxs("div",{id:"GalleryImage",children:[r.jsxs("div",{id:"gi-main",children:[r.jsx("div",{id:"gallery-image-container",children:r.jsx("img",{src:t.imageLink,alt:t.title,id:"gallery-image"})}),r.jsxs("div",{id:"gi-data",children:[r.jsx("h1",{id:"gi-image-title",children:t.title}),r.jsx("br",{}),r.jsx("p",{id:"gi-description",children:t.description}),r.jsx("br",{}),r.jsxs("code",{id:"gallery-image-address",children:[r.jsx("p",{id:"gallery-address-heading",children:"Image address:"}),r.jsx("a",{href:t.imageLink,className:"gallery-img-link",children:t.imageLink})]}),r.jsx("a",{id:"gallery-download-link",href:t.imageLink,download:t.title,children:r.jsx("h2",{children:"Download Image"})})]})]}),r.jsx(K,{children:r.jsx(_,{keywords:t.keywords,exclude:[t.id]})})]}):r.jsx("div",{id:"GalleryImage",children:r.jsx("div",{className:"loader"})})}export{re as default};
